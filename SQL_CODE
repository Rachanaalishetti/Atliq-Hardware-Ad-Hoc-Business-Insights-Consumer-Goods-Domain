Task 01

SELECT market FROM gdb023.dim_customer
where region="apac" and customer like "%Atliq Exclusive%"
group by market;

Task 02

SELECT 
	count(distinct case when fiscal_year=2020 then product_code end ) as unique_product_2020,
	count(distinct case when fiscal_year=2021 then product_code end) as unique_product_2021 ,
	(
	count(distinct case when fiscal_year=2021 then product_code end ) -
	count(distinct case when fiscal_year=2020 then product_code end))*100
	/count(distinct case when fiscal_year=2020 then product_code end )  as percentage_chg
from dim_product p 
join fact_sales_monthly s
using(product_code);

Task 03

SELECT 
	segment ,
	count(product_code) product_count
 FROM gdb023.dim_product
 group by segment 
 order by product_count desc;


Task04

with cte as (
		 select segment ,
		count(distinct case when fiscal_year =2020 then product_code        end) as product_count_2020,
		count(distinct case when fiscal_year =2021 then product_code end ) as product_count_2021
		from dim_product p 
		join fact_sales_monthly s
		using(product_code)
		group by segment
		order by product_count_2020 desc
)
select * ,(product_count_2021-product_count_2020) as difference
from cte
order by difference desc;


TASK 05

with cte2 as (
		 select category,
		 CONCAT(product,' (', variant, ')')as product ,
		 p.product_code,
		 manufacturing_cost
	from dim_product p
	join fact_manufacturing_cost 
	using (product_code)
	order by manufacturing_cost desc
         )
select * from cte2 where manufacturing_cost in (
					  (select max(manufacturing_cost) from fact_manufacturing_cost),
					  (select min(manufacturing_cost) from fact_manufacturing_cost)
                                               );

TASK 06

SELECT
	 customer_code,
	 customer,
	 round(avg(pre_invoice_discount_pct)*100,2)  as avg
 FROM gdb023.dim_customer c
 join fact_pre_invoice_deductions p
 using(customer_code)
 where market ="india" and fiscal_year=2021 
 group by customer,customer_code
 order by avg desc limit 5;

TASK 07


select 
      monthname(date) as month,
      s.fiscal_year ,round(sum(sold_quantity*gross_price ),2) as gross_sales_amount
 from fact_sales_monthly s
 join fact_gross_price g
 using(product_code)
 join dim_customer c
 using(customer_code)
where customer='Atliq Exclusive'
 group by month ,s.fiscal_year
 order by fiscal_year;

TASK 08

select
 CASE 
        WHEN MONTH(date) IN (9,10,11) THEN 'Q1'
        WHEN MONTH(date) IN (12,1,2) THEN 'Q2'
        WHEN MONTH(date) IN (3,4,5) THEN 'Q3'
        ELSE 'Q4'
    END AS quarter,
    sum(sold_quantity) as total_sold_quantity
    from fact_sales_monthly
        where fiscal_year=2020
    group by quarter 

    order by quarter,total_sold_quantity;

TASK 09

 with temporary_table as (
				SELECT C.channel,sum(sold_quantity*gross_price) as Total_gross_sales
				FROM fact_sales_monthly s
				JOIN dim_customer c ON c.customer_code=s.customer_code
				JOIN fact_gross_price G on G.product_code=s.product_code
				where s.fiscal_year=2021
				group by C.channel
			        order by total_gross_sales desc
                         )
 select channel,
 round(sum(total_gross_sales),2) as gross_sales_mil,
 round((total_gross_sales)*100/sum(total_gross_sales) over(),2) as percentage
 from temporary_table
 group by channel;

TASK 10

with cte as(
			select division,p.product_code,p.product,category, sum(sold_quantity) as total_sold_quantity
			from dim_product p
			join fact_sales_monthly s
			using(product_code)
			group by product
           ) ,
cte2  as (select *,DENSE_RANK() OVER ( partition by division ORDER BY total_sold_quantity desc ) as rank_order from cte )
select * from cte2 where rank_order<=3;


